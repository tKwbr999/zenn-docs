---
title: 'æ—¥æœ¬èªã®èª¤é€ä¿¡ã‚’ã“ã®ä¸–ã‹ã‚‰æ¶ˆã—å»ã‚ŠãŸã„'
emoji: 'ğŸ’£'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [javaScript, tampermonkey, firebasestudio, AIé§†å‹•]
published: true
---

## tl;dr

[Tampermonkey](https://chromewebstore.google.com/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?pli=1)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã‚‹

```javascript
// ==UserScript==
// @name        æ—¥æœ¬èªIMEèª¤é€ä¿¡é˜²æ­¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
// @namespace   https://github.com/tkwbr999
// @version     1.0.0
// @description æ—¥æœ¬èªå…¥åŠ›æ™‚ã®IMEå¤‰æ›ä¸­ãŠã‚ˆã³å¤‰æ›ç¢ºå®šç›´å¾Œã®Enterã‚­ãƒ¼ã«ã‚ˆã‚‹èª¤é€ä¿¡ã‚’é˜²æ­¢ã—ã¾ã™
// @author      tkwbr999
// @match       https://studio.firebase.google.com/*
// @grant       none
// @license     MIT
// @run-at      document-start
// ==/UserScript==

(function () {
  'use strict';

  // å¯¾è±¡ã¨ãªã‚‹ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã‚’é¸æŠã™ã‚‹ãŸã‚ã®ã‚»ãƒ¬ã‚¯ã‚¿
  // å¿…è¦ã«å¿œã˜ã¦å¤‰æ›´ã—ã¦ãã ã•ã„
  const FORM_ELEMENTS_SELECTOR = 'textarea, input[type="text"], [contenteditable="true"]';

  // é€ä¿¡ãƒœã‚¿ãƒ³ã®ã‚»ãƒ¬ã‚¯ã‚¿ï¼ˆå¿…è¦ã«å¿œã˜ã¦å¤‰æ›´ï¼‰
  const SUBMIT_BUTTON_SELECTOR =
    'button[type="submit"], input[type="submit"], button.submit, button.send, button[data-action="submit"]';

  // JSåˆ¶å¾¡ã®ãƒœã‚¿ãƒ³ã®è¿½åŠ ã‚»ãƒ¬ã‚¯ã‚¿ï¼ˆå¿…è¦ã«å¿œã˜ã¦å¤‰æ›´ï¼‰
  const JS_BUTTON_SELECTOR =
    'button:not([type="button"]), .btn-submit, .submit-button, [aria-label="Send"], [data-testid="send"]';

  // æ—¥æœ¬èªIMEã®å¤‰æ›ä¸­ã‹ã©ã†ã‹ã‚’è¿½è·¡ã™ã‚‹ãƒ•ãƒ©ã‚°
  let isComposing = false;

  // IMEã®å…¥åŠ›é–‹å§‹ã‚’æ¤œå‡º
  document.addEventListener(
    'compositionstart',
    function () {
      isComposing = true;
    },
    { capture: true }
  );

  // IMEã®å…¥åŠ›çµ‚äº†ã‚’æ¤œå‡º
  document.addEventListener(
    'compositionend',
    function () {
      isComposing = false;
    },
    { capture: true }
  );

  // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã¾ãŸã¯é–¢é€£ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚’å‡¦ç†ã™ã‚‹é–¢æ•°
  function handleSubmitAction(element) {
    // æœ€ã‚‚è¿‘ã„ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ¢ã™
    const form = element.closest('form');

    if (form) {
      // ãƒ•ã‚©ãƒ¼ãƒ ãŒã‚ã‚‹å ´åˆã¯é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒ
      form.dispatchEvent(new Event('submit', { bubbles: true, cancelable: true }));
      return;
    }

    // ãƒ•ã‚©ãƒ¼ãƒ ãŒãªã„å ´åˆã€é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æ¢ã™
    let submitButton = null;

    // æ¨™æº–ã®é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æ¢ã™
    submitButton = document.querySelector(SUBMIT_BUTTON_SELECTOR);

    // è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯JSåˆ¶å¾¡ã®ãƒœã‚¿ãƒ³ã‚’æ¢ã™
    if (!submitButton) {
      submitButton = document.querySelector(JS_BUTTON_SELECTOR);
    }

    // è¦ç´ ãŒè¦‹ã¤ã‹ã£ãŸã‚‰æ®µéšçš„ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼
    if (submitButton) {
      // ãƒã‚¦ã‚¹ãƒ€ã‚¦ãƒ³ã€ãƒã‚¦ã‚¹ã‚¢ãƒƒãƒ—ã€ã‚¯ãƒªãƒƒã‚¯ã®é †ã«å®Ÿè¡Œ
      submitButton.dispatchEvent(new MouseEvent('mousedown', { bubbles: true, cancelable: true }));
      submitButton.dispatchEvent(new MouseEvent('mouseup', { bubbles: true, cancelable: true }));
      submitButton.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true }));

      // ã‚¿ãƒƒãƒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ç”¨ã«ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã‚‚ç™ºç«
      submitButton.dispatchEvent(new Event('touchstart', { bubbles: true, cancelable: true }));
      submitButton.dispatchEvent(new Event('touchend', { bubbles: true, cancelable: true }));
    }
  }

  // ã‚­ãƒ¼å…¥åŠ›ã‚’æ•æ‰
  document.addEventListener(
    'keydown',
    function (event) {
      // Enterã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸå ´åˆ
      if (event.key === 'Enter') {
        // å…¥åŠ›è¦ç´ å†…ã§ã®Enterã‚­ãƒ¼ã‚’æ¤œå‡º
        const isInputElement = event.target.matches(FORM_ELEMENTS_SELECTOR);

        // IMEå¤‰æ›ä¸­ã¯å¸¸ã«Enterã‚­ãƒ¼ã‚’ãƒ–ãƒ­ãƒƒã‚¯
        if (isComposing || event.isComposing) {
          event.preventDefault();
          event.stopPropagation();
          return false;
        }

        // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢å†…ã§ã®Enterã‚­ãƒ¼ã¯æ”¹è¡Œã¨ã—ã¦å‡¦ç†ï¼ˆãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’ãƒ–ãƒ­ãƒƒã‚¯ï¼‰
        if (isInputElement && !event.metaKey && !event.ctrlKey) {
          // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å ´åˆã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ”¹è¡Œå‹•ä½œã‚’è¨±å¯
          if (event.target.tagName.toLowerCase() === 'textarea') {
            // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã®ã¿ã‚’ãƒ–ãƒ­ãƒƒã‚¯
            const form = event.target.closest('form');
            if (form) {
              // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€ä¿¡ã‚’ãƒ–ãƒ­ãƒƒã‚¯
              form.addEventListener(
                'submit',
                function (e) {
                  if (!e.metaKey && !e.ctrlKey) {
                    e.preventDefault();
                    e.stopPropagation();
                  }
                },
                { once: true }
              );
            }
            // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®æ”¹è¡Œã¯ãã®ã¾ã¾è¨±å¯ã™ã‚‹ï¼ˆpreventDefault ã—ãªã„ï¼‰
            return true;
          }

          // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ä»¥å¤–ã®å…¥åŠ›è¦ç´ ã§ã¯Enterã‚’ãƒ–ãƒ­ãƒƒã‚¯
          event.preventDefault();
          event.stopPropagation();
          return false;
        }

        // Cmd+Enterã¾ãŸã¯Ctrl+Enterã®å ´åˆã¯ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã¾ãŸã¯é–¢é€£ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
        if (isInputElement && (event.metaKey || event.ctrlKey)) {
          event.preventDefault();
          handleSubmitAction(event.target);
          return false;
        }
      }
    },
    { capture: true }
  );

  // ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ
  document.addEventListener(
    'beforeinput',
    function (event) {
      if (event.inputType === 'insertLineBreak' || event.inputType === 'insertParagraph') {
        // IMEå¤‰æ›ä¸­ã¾ãŸã¯é€šå¸¸ã®Enterå…¥åŠ›ã®å ´åˆã¯ãƒ–ãƒ­ãƒƒã‚¯
        if (isComposing || event.isComposing || !(event.metaKey || event.ctrlKey)) {
          event.preventDefault();
        }
      }
    },
    { capture: true }
  );
})();
```

## ğŸ˜± æ—¥æœ¬èªã®å¤‰æ›ã£ã¦å¥´ãŒã­ãƒ»ãƒ»ãƒ»

æ—¥æœ¬èªå…¥åŠ›ã§ã¯å¤‰æ›æ“ä½œã«ã‚‚ Enter ã‚’ä½¿ã†ã®ã§ç›¸æ€§ãŒæ‚ªã„ã‚“ã§ã™ã‚ˆã­ãƒ»ãƒ»ãƒ»

ã¨ã„ã†ã‚ã‘ã§ä½œã£ãŸã®ãŒã•ã£ãã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚

è¦ã™ã‚‹ã«ã€Œé€ä¿¡ã™ã‚‹ã¨ãã¯ Cmd+Enterã€ã¨ã„ã†æ„Ÿã˜ã®ã‚‚ã®ã§ã™ã€‚

ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’åƒ•ã®æ‰‹å…ƒã§ã‚‚è©¦ã—ã¦ã„ãŸã®ã§ã™ãŒã€ã“ã®å¯¾ç­–ã‚’è¶…ãˆã‚‹ç´ æ™´ã‚‰ã—ã„ãƒ„ãƒ¼ãƒ«ãŒä¸–ã«æ”¾ãŸã‚Œã¦ã—ã¾ã£ãŸã®ã§æ”¹è‰¯ã—ãŸæ„Ÿã˜ã§ã™ã€‚

https://zenn.dev/knziiy/articles/notebooklm-japanese-enter-fix

## ğŸ”§ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å°å…¥æ–¹æ³•

lt;dr ã®é€šã‚Šãªã®ã§ã™ãŒæ”¹ã‚ã¦ã€‚

[Tampermonkey](https://chromewebstore.google.com/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?pli=1)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

![Tampermonkey](https://storage.googleapis.com/zenn-user-upload/2722240fb0be-20250412.png)

ãã®ã‚ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ–°è¦ä½œæˆã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ–°è¦ä½œæˆã®åˆæœŸç”»é¢](https://storage.googleapis.com/zenn-user-upload/eec70e43f0ad-20250412.png)

è¨­å®šã‚¿ãƒ–ã‹ã‚‰ä»»æ„ã®ã‚µã‚¤ãƒˆã‚’è¿½åŠ ã™ã‚‹ã€‚ã‚‚ã—ãã¯è¡Œã¯å‰Šé™¤ã›ãšã«èµ·å‹•ã—ãŸããªã„ã‚µã‚¤ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚ç”»åƒã¯ä»»æ„ã®ã‚µã‚¤ãƒˆã‚’è¿½åŠ ã™ã‚‹è¨­å®šä¾‹ã§ã™ã€‚

![ä»»æ„ã®ã‚µã‚¤ãƒˆã®è¨­å®šä¾‹](https://storage.googleapis.com/zenn-user-upload/8f08381af590-20250412.png)

ã‚µã‚¤ãƒˆã«ã‚ˆã£ã¦ã¯é€ä¿¡ãƒœã‚¿ãƒ³ã®ã‚»ãƒ¬ã‚¯ã‚¿ãŒç•°ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã¯ä»¥ä¸‹ã®å¤‰æ•°ã‚’ç·¨é›†ã—ã¦ãã ã•ã„ã€‚

```javascript
// å¯¾è±¡ã¨ãªã‚‹ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã‚’é¸æŠã™ã‚‹ãŸã‚ã®ã‚»ãƒ¬ã‚¯ã‚¿
const FORM_ELEMENTS_SELECTOR = 'textarea, input[type="text"], [contenteditable="true"]';

// é€ä¿¡ãƒœã‚¿ãƒ³ã®ã‚»ãƒ¬ã‚¯ã‚¿
const SUBMIT_BUTTON_SELECTOR =
  'button[type="submit"], input[type="submit"], button.submit, button.send, button[data-action="submit"]';

// JSåˆ¶å¾¡ã®ãƒœã‚¿ãƒ³ã®è¿½åŠ ã‚»ãƒ¬ã‚¯ã‚¿
const JS_BUTTON_SELECTOR =
  'button:not([type="button"]), .btn-submit, .submit-button, [aria-label="Send"], [data-testid="send"]';
```

ä»¥ä¸Šã«ãªã‚Šã¾ã™ ğŸ™‡

## å‚è€ƒ

- **NotebookLM ã§æ—¥æœ¬èªå…¥åŠ›ä¸­ã® Enter ç¢ºå®šé€ä¿¡ã‚’é˜²ã Tampermonkey ã‚¹ã‚¯ãƒªãƒ—ãƒˆ** : https://zenn.dev/knziiy/articles/notebooklm-japanese-enter-fix
- **GitHub**: [https://github.com/tkwbr999/japanese-ime-script](https://github.com/tkwbr999/japanese-ime-script)
